# –í–∏–¥–µ–æ–º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ (Gradio)

## –û–ø–∏—Å–∞–Ω–∏–µ

–í–µ–±-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –¥–ª—è –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ RTSP-–ø–æ—Ç–æ–∫–æ–≤ –∏ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –≤—Å–µ—Ö –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ —Ñ–∞–π–ª–∞ `config.yaml` —á–µ—Ä–µ–∑ —É–¥–æ–±–Ω—ã–π –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å. –í—Å–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è –º–æ–∂–Ω–æ —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å –ª–æ–∫–∞–ª—å–Ω–æ, –æ—Ç–ø—Ä–∞–≤–∏—Ç—å –Ω–∞ —Ä–æ–∫—á–∏–ø —á–µ—Ä–µ–∑ SCP –∏–ª–∏ —á–µ—Ä–µ–∑ API. –ò–Ω—Ç–µ—Ä—Ñ–µ–π—Å –ø–æ–ª–Ω–æ—Å—Ç—å—é –Ω–∞ —Ä—É—Å—Å–∫–æ–º —è–∑—ã–∫–µ.

## –ó–∞–ø—É—Å–∫ —á–µ—Ä–µ–∑ Docker Compose

1. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ —Ñ–∞–π–ª `opi5test/core/config.yaml` —Å—É—â–µ—Å—Ç–≤—É–µ—Ç –∏ —Å–æ–¥–µ—Ä–∂–∏—Ç –Ω—É–∂–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã.
2. –ü–µ—Ä–µ–π–¥–∏—Ç–µ –≤ –ø–∞–ø–∫—É `web`:
   ```bash
   cd web
   ```
3. –°–æ–±–µ—Ä–∏—Ç–µ –∏ –∑–∞–ø—É—Å—Ç–∏—Ç–µ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä:
   ```bash
   docker-compose up --build
   ```
4. –û—Ç–∫—Ä–æ–π—Ç–µ –±—Ä–∞—É–∑–µ—Ä –∏ –ø–µ—Ä–µ–π–¥–∏—Ç–µ –ø–æ –∞–¥—Ä–µ—Å—É: [http://localhost:7860](http://localhost:7860)

5. –î–ª—è –æ—Å—Ç–∞–Ω–æ–≤–∫–∏ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞ –ø–µ—Ä–µ–π–¥–∏—Ç–µ –≤ –ø–∞–ø–∫—É `web` –∏ –≤—ã–ø–æ–ª–Ω–∏—Ç–µ —Å–ª–µ–¥—É—é—â—É—é –∫–æ–º–∞–Ω–¥—É:

   ```bash
   docker-compose down
   ```

## –ó–∞–ø—É—Å–∫ –≤ –≤–∏—Ä—Ç—É–∞–ª—å–Ω–æ–º –æ–∫—Ä—É–∂–µ–Ω–∏–∏

1. –°–æ–∑–¥–∞–π—Ç–µ –≤–∏—Ä—Ç—É–∞–ª—å–Ω–æ–µ –æ–∫—Ä—É–∂–µ–Ω–∏–µ:
   ```bash
   python3 -m venv web_venv
   source web_venv/bin/activate
   ```

2. –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏:
   ```bash
   pip install gradio requests websocket-client opencv-python numpy
   ```

3. –ó–∞–ø—É—Å—Ç–∏—Ç–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ:
   ```bash
   python3 app.py
   ```

## –§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª

### –í–∏–¥–µ–æ–º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥
- –û–∫–Ω–æ –¥–ª—è –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ RTSP-–ø–æ—Ç–æ–∫–∞ (—Ç—Ä–µ–±—É–µ—Ç—Å—è –ø—Ä–æ–∫—Å–∏ –¥–ª—è —Ä–µ–∞–ª—å–Ω–æ–≥–æ –≤–∏–¥–µ–æ)
- –ü–æ–ª–µ –¥–ª—è –≤–≤–æ–¥–∞ RTSP-URL
- –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ UDP —Ç—Ä–µ–≤–æ–≥ –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏

### –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–µ–π
- –í—Å–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –∏–∑ `config.yaml` –¥–æ—Å—Ç—É–ø–Ω—ã –¥–ª—è —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
- –ö–Ω–æ–ø–∫–∞ **"–°–æ—Ö—Ä–∞–Ω–∏—Ç—å"** ‚Äî —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç –∏–∑–º–µ–Ω–µ–Ω–∏—è –≤ `config.yaml` –∏ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –Ω–∞ —Ä–æ–∫—á–∏–ø —á–µ—Ä–µ–∑ SCP
- –ö–Ω–æ–ø–∫–∞ **"–û—Ç–ø—Ä–∞–≤–∏—Ç—å —á–µ—Ä–µ–∑ API"** ‚Äî —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç –ª–æ–∫–∞–ª—å–Ω–æ –∏ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –Ω–∞ —Ä–æ–∫—á–∏–ø —á–µ—Ä–µ–∑ API
- –ö–Ω–æ–ø–∫–∞ **"–°–±—Ä–æ—Å–∏—Ç—å"** ‚Äî –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –∑–Ω–∞—á–µ–Ω–∏—è –∏–∑ —Ñ–∞–π–ª–∞

### –õ–æ–≥–∏ —Ç—Ä–µ–≤–æ–≥
- –ü–æ–ª—É—á–µ–Ω–∏–µ —Å–ø–∏—Å–∫–∞ —Ñ–∞–π–ª–æ–≤ –ª–æ–≥–æ–≤ —Å —Ä–æ–∫—á–∏–ø–∞
- –ü—Ä–æ—Å–º–æ—Ç—Ä —Å–æ–¥–µ—Ä–∂–∏–º–æ–≥–æ –ª–æ–≥–æ–≤
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å–ø–∏—Å–∫–∞

## –ü–∞—Ä–∞–º–µ—Ç—Ä—ã –Ω–µ–π—Ä–æ–Ω–Ω–æ–π —Å–µ—Ç–∏

### –î–µ—Ç–µ–∫—Ü–∏—è –Ω–∞—Ä—É—à–µ–Ω–∏–π
- **cigarette** - –¥–µ—Ç–µ–∫—Ü–∏—è –∫—É—Ä–µ–Ω–∏—è
  - `duration`: –¥–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –Ω–∞—Ä—É—à–µ–Ω–∏—è –≤ —Å–µ–∫—É–Ω–¥–∞—Ö (0.1)
  - `threshold`: –ø–æ—Ä–æ–≥ —É–≤–µ—Ä–µ–Ω–Ω–æ—Å—Ç–∏ –¥–µ—Ç–µ–∫—Ç–æ—Ä–∞ (0.8)

- **closed_eyes** - –¥–µ—Ç–µ–∫—Ü–∏—è –∑–∞–∫—Ä—ã—Ç—ã—Ö –≥–ª–∞–∑
  - `duration`: –¥–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –Ω–∞—Ä—É—à–µ–Ω–∏—è –≤ —Å–µ–∫—É–Ω–¥–∞—Ö (1.0)
  - `threshold`: –ø–æ—Ä–æ–≥ —É–≤–µ—Ä–µ–Ω–Ω–æ—Å—Ç–∏ –¥–µ—Ç–µ–∫—Ç–æ—Ä–∞ (0.8)

- **closed_eyes_duration** - –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ –≤—Ä–µ–º–µ–Ω–∏ –∑–∞–∫—Ä—ã—Ç—ã—Ö –≥–ª–∞–∑
  - `tracking_window`: –æ–∫–Ω–æ –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è –≤ —Å–µ–∫—É–Ω–¥–∞—Ö (60)
  - `threshold`: –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–µ –≤—Ä–µ–º—è –∑–∞–∫—Ä—ã—Ç—ã—Ö –≥–ª–∞–∑ –≤ —Å–µ–∫—É–Ω–¥–∞—Ö (10)

- **head_pose** - –¥–µ—Ç–µ–∫—Ü–∏—è –ø–æ–≤–æ—Ä–æ—Ç–∞ –≥–æ–ª–æ–≤—ã
  - `duration`: –¥–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –Ω–∞—Ä—É—à–µ–Ω–∏—è –≤ —Å–µ–∫—É–Ω–¥–∞—Ö (1.8)
  - `pitch`: —É–≥–æ–ª –Ω–∞–∫–ª–æ–Ω–∞ –≥–æ–ª–æ–≤—ã –≤ —Ä–∞–¥–∏–∞–Ω–∞—Ö (0.5)
  - `yaw`: —É–≥–æ–ª –ø–æ–≤–æ—Ä–æ—Ç–∞ –≥–æ–ª–æ–≤—ã –≤ —Ä–∞–¥–∏–∞–Ω–∞—Ö (1.5)

- **no_belt** - –¥–µ—Ç–µ–∫—Ü–∏—è –æ—Ç—Å—É—Ç—Å—Ç–≤–∏—è —Ä–µ–º–Ω—è –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏
  - `duration`: –¥–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –Ω–∞—Ä—É—à–µ–Ω–∏—è –≤ —Å–µ–∫—É–Ω–¥–∞—Ö (1.5)
  - `threshold`: –ø–æ—Ä–æ–≥ —É–≤–µ—Ä–µ–Ω–Ω–æ—Å—Ç–∏ –¥–µ—Ç–µ–∫—Ç–æ—Ä–∞ (0.8)

- **no_driver** - –¥–µ—Ç–µ–∫—Ü–∏—è –æ—Ç—Å—É—Ç—Å—Ç–≤–∏—è –≤–æ–¥–∏—Ç–µ–ª—è
  - `duration`: –¥–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –Ω–∞—Ä—É—à–µ–Ω–∏—è –≤ —Å–µ–∫—É–Ω–¥–∞—Ö (0.5)
  - `threshold`: –ø–æ—Ä–æ–≥ —É–≤–µ—Ä–µ–Ω–Ω–æ—Å—Ç–∏ –¥–µ—Ç–µ–∫—Ç–æ—Ä–∞ (0.8)

- **no_face** - –¥–µ—Ç–µ–∫—Ü–∏—è –æ—Ç—Å—É—Ç—Å—Ç–≤–∏—è –ª–∏—Ü–∞
  - `duration`: –¥–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –Ω–∞—Ä—É—à–µ–Ω–∏—è –≤ —Å–µ–∫—É–Ω–¥–∞—Ö (0.5)
  - `threshold`: –ø–æ—Ä–æ–≥ —É–≤–µ—Ä–µ–Ω–Ω–æ—Å—Ç–∏ –¥–µ—Ç–µ–∫—Ç–æ—Ä–∞ (0.8)

- **phone** - –¥–µ—Ç–µ–∫—Ü–∏—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è —Ç–µ–ª–µ—Ñ–æ–Ω–∞
  - `duration`: –¥–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –Ω–∞—Ä—É—à–µ–Ω–∏—è –≤ —Å–µ–∫—É–Ω–¥–∞—Ö (0.5)
  - `threshold`: –ø–æ—Ä–æ–≥ —É–≤–µ—Ä–µ–Ω–Ω–æ—Å—Ç–∏ –¥–µ—Ç–µ–∫—Ç–æ—Ä–∞ (0.8)

- **yawn** - –¥–µ—Ç–µ–∫—Ü–∏—è –∑–µ–≤–æ—Ç—ã
  - `duration`: –¥–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –Ω–∞—Ä—É—à–µ–Ω–∏—è –≤ —Å–µ–∫—É–Ω–¥–∞—Ö (0.5)
  - `threshold`: –ø–æ—Ä–æ–≥ —É–≤–µ—Ä–µ–Ω–Ω–æ—Å—Ç–∏ –¥–µ—Ç–µ–∫—Ç–æ—Ä–∞ (0.3)

### –°–∏—Å—Ç–µ–º–∞ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è —É—Å—Ç–∞–ª–æ—Å—Ç–∏ (fatigue)

–í–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –≤–∫–ª—é—á–∞–µ—Ç —Ä–∞–∑–¥–µ–ª **¬´–ù–∞—Å—Ç—Ä–æ–π–∫–∏ —É—Å—Ç–∞–ª–æ—Å—Ç–∏¬ª** –¥–ª—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –∫–æ–º–ø–ª–µ–∫—Å–Ω–æ–π —Å–∏—Å—Ç–µ–º—ã –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è –ø—Ä–∏–∑–Ω–∞–∫–æ–≤ —É—Ç–æ–º–ª–µ–Ω–∏—è –≤–æ–¥–∏—Ç–µ–ª—è.

**–û—Å–Ω–æ–≤–Ω—ã–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã:**
- **–î–ª–∏–Ω–Ω—ã–µ –º–æ—Ä–≥–∞–Ω–∏—è** ‚Äî —á–∞—Å—Ç—ã–µ –ø—Ä–æ–¥–æ–ª–∂–∏—Ç–µ–ª—å–Ω—ã–µ –∑–∞–∫—Ä—ã—Ç–∏—è –≥–ª–∞–∑
- **–¢—Ä–µ–Ω–¥ –º–µ–∂–º–æ—Ä–≥–∞–Ω–∏–π** ‚Äî —É—á–∞—â–µ–Ω–∏–µ –º–æ—Ä–≥–∞–Ω–∏–π (—É–º–µ–Ω—å—à–µ–Ω–∏–µ –∏–Ω—Ç–µ—Ä–≤–∞–ª–æ–≤)
- **–ó–µ–≤–∫–∏** ‚Äî –¥–ª–∏—Ç–µ–ª—å–Ω—ã–µ –æ—Ç–∫—Ä—ã—Ç–∏—è —Ä—Ç–∞
- **¬´–ö–ª–µ–≤–∫–∏¬ª –≥–æ–ª–æ–≤–æ–π** ‚Äî –∫–∏–≤–∫–∏ –≥–æ–ª–æ–≤–æ–π –≤–Ω–∏–∑ —Å –ø–æ—Å–ª–µ–¥—É—é—â–∏–º –≤–æ–∑–≤—Ä–∞—Ç–æ–º

**–†–µ–∂–∏–º—ã —Ä–∞–±–æ—Ç—ã:**
- **–ù–µ–∑–∞–≤–∏—Å–∏–º—ã–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã** ‚Äî —Ç—Ä–µ–≤–æ–≥–∞ –ø—Ä–∏ –ø—Ä–µ–≤—ã—à–µ–Ω–∏–∏ –ø–æ—Ä–æ–≥–∞ –ª—é–±—ã–º –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–º
- **–ö–æ–º–ø–æ–∑–∏—Ç–Ω–∞—è –ª–æ–≥–∏–∫–∞** ‚Äî —Ç—Ä–µ–≤–æ–≥–∞ –ø—Ä–∏ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏–∏ —Å—É–º–º–∞—Ä–Ω–æ–≥–æ –ø–æ—Ä–æ–≥–∞ –æ—Ç –≤—Å–µ—Ö –≤–∫–ª—é—á—ë–Ω–Ω—ã—Ö –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤

üìö **–ü–æ–¥—Ä–æ–±–Ω–∞—è –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –ø–æ –Ω–∞—Å—Ç—Ä–æ–π–∫–µ —É—Å—Ç–∞–ª–æ—Å—Ç–∏:** [`FATIGUE_CONFIG.md`](FATIGUE_CONFIG.md)

## API –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è

–ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –æ—Ç–ø—Ä–∞–≤–∫—É –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ –Ω–∞ —Ä–æ–∫—á–∏–ø —á–µ—Ä–µ–∑ API:

- **Endpoint**: `PUT /config`
- **–ü—Ä–æ—Ç–æ–∫–æ–ª**: HTTP
- **–§–æ—Ä–º–∞—Ç**: JSON
- **–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –æ—Ç–ø—Ä–∞–≤–∫–∞**: –ø—Ä–∏ –Ω–∞–∂–∞—Ç–∏–∏ –∫–Ω–æ–ø–∫–∏ "–û—Ç–ø—Ä–∞–≤–∏—Ç—å —á–µ—Ä–µ–∑ API"

### –ù–∞—Å—Ç—Ä–æ–π–∫–∞ API
–í —Å–µ–∫—Ü–∏–∏ `rockchip` –∫–æ–Ω—Ñ–∏–≥–∞:
- `api_port`: –ø–æ—Ä—Ç API —Å–µ—Ä–≤–∏—Å–∞ –Ω–∞ —Ä–æ–∫—á–∏–ø–µ (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é 8000)

## –í–∞–∂–Ω–æ

–í —Ñ–∞–π–ª–µ `config.yaml` –ø–∞—Ä–∞–º–µ—Ç—Ä `alarm_server_ip` –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω –≤ IP-–∞–¥—Ä–µ—Å –º–∞—à–∏–Ω—ã, –≥–¥–µ –∑–∞–ø—É—â–µ–Ω Gradio-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å. –ï—Å–ª–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è –≤ Docker, –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ –≤–Ω–µ—à–Ω–∏–π IP —Ö–æ—Å—Ç–∞. –¢—Ä–µ–≤–æ–≥–∏ –∏–∑ —è–¥—Ä–∞ –¥–æ–ª–∂–Ω—ã –æ—Ç–ø—Ä–∞–≤–ª—è—Ç—å—Å—è –Ω–∞ —ç—Ç–æ—Ç –∞–¥—Ä–µ—Å –∏ –ø–æ—Ä—Ç, —É–∫–∞–∑–∞–Ω–Ω—ã–µ –≤ `alarm_server_ip` –∏ `alarm_server_port`.

---

**–í–Ω–∏–º–∞–Ω–∏–µ:** –î–ª—è —Ä–µ–∞–ª—å–Ω–æ–≥–æ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è RTSP-–ø–æ—Ç–æ–∫–æ–≤ –≤ –±—Ä–∞—É–∑–µ—Ä–µ —Ç—Ä–µ–±—É–µ—Ç—Å—è –ø—Ä–æ–∫—Å–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–æ—Ç–æ–∫–∞ –≤ HLS/WebRTC. –í —Ç–µ–∫—É—â–µ–π –≤–µ—Ä—Å–∏–∏ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞ –∑–∞–≥–ª—É—à–∫–∞ –¥–ª—è –≤–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏–∏ URL. 